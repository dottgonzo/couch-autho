"use strict";
var chai = require("chai");
var rpj = require('request-promise-json');
var index_1 = require("../index");
var spawnPouchdbServer = require('spawn-pouchdb-server');
var expect = chai.expect;
var should = chai.should;
var usercredentials = {};
var Server;
var db = __dirname + '/../.db';
var CouchAuth;
before(function (done) {
    this.timeout(10000);
    spawnPouchdbServer({
        port: 8741,
        backend: false,
        config: {
            admins: { "adminuser": "adminpass" },
            file: false
        },
        log: {
            file: false,
            level: 'info'
        }
    }, function (error, server) {
        if (error) {
            throw error;
        }
        else {
            Server = server;
            CouchAuth = new index_1.default({
                hostname: 'localhost',
                protocol: 'http',
                port: 8741,
                user: 'adminuser',
                password: 'adminpass'
            });
            setTimeout(function () {
                done();
            }, 5000);
        }
    });
});
describe("test app_main", function () {
    this.timeout(20000);
    it("verificate presence of app_main db", function (done) {
        rpj.get(CouchAuth.my('app_main')).then(function (d) {
            expect(d.db_name).to.be.eq('app_main');
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("verificate that app_main db is private", function (done) {
        rpj.get(CouchAuth.publink + '/app_main').then(function (d) {
            done(Error(d));
        }).catch(function (err) {
            console.log(err);
            expect(err).to.be.ok;
            done();
        });
    });
});
describe("main admins", function () {
    it("create a main admin (for test only)", function (done) {
    });
    it("create an app", function (done) {
    });
});
describe("users", function () {
    it("user registration", function (done) {
    });
    it("user subscribe an app", function (done) {
    });
    it("user login", function (done) {
    });
    it("create a machine for an app subscribed", function (done) {
    });
    it("can't create a machine for an app that not subscribed yet", function (done) {
    });
    it("share a machine that own", function (done) {
    });
    it("can't share a machine that not own", function (done) {
    });
    it("change a user role for a machine that own", function (done) {
    });
    it("can't change  a user role for a machine that not own", function (done) {
    });
    it("delete a machine that own", function (done) {
    });
    it("can't delete a machine that not own", function (done) {
    });
    it("garant a privilege", function (done) {
    });
    it("revoke a privilege", function (done) {
    });
});
after(function (done) {
    Server.stop(function () {
        done();
    });
});

//# sourceMappingURL=data:application/json;base64,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LEVBQUUsVUFBVSxJQUFJO0lBQ3hELENBQUMsQ0FBQyxDQUFBO0lBQ0YsRUFBRSxDQUFDLG9CQUFvQixFQUFFLFVBQVUsSUFBSTtJQUN2QyxDQUFDLENBQUMsQ0FBQTtJQUNGLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxVQUFVLElBQUk7SUFDdkMsQ0FBQyxDQUFDLENBQUE7QUFDTixDQUFDLENBQUMsQ0FBQztBQUVILEtBQUssQ0FBQyxVQUFVLElBQUk7SUFDaEIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNSLElBQUksRUFBRSxDQUFBO0lBQ1YsQ0FBQyxDQUFDLENBQUE7QUFFTixDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBtb2NoYSBmcm9tIFwibW9jaGFcIjtcbmltcG9ydCAqIGFzIGNoYWkgZnJvbSBcImNoYWlcIjtcblxubGV0IHJwaiA9IHJlcXVpcmUoJ3JlcXVlc3QtcHJvbWlzZS1qc29uJyk7XG5cbmltcG9ydCBjb3VjaGF1dGggZnJvbSBcIi4uL2luZGV4XCI7XG5cblxuY29uc3Qgc3Bhd25Qb3VjaGRiU2VydmVyID0gcmVxdWlyZSgnc3Bhd24tcG91Y2hkYi1zZXJ2ZXInKTtcblxuXG5cbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxubGV0IHNob3VsZCA9IGNoYWkuc2hvdWxkO1xuXG5sZXQgdXNlcmNyZWRlbnRpYWxzID0ge1xuXG59O1xuXG5cblxubGV0IFNlcnZlcjtcblxubGV0IGRiID0gX19kaXJuYW1lICsgJy8uLi8uZGInXG5cbmxldCBDb3VjaEF1dGg6IGNvdWNoYXV0aDtcblxuXG5cbmJlZm9yZShmdW5jdGlvbiAoZG9uZSkge1xuICAgIHRoaXMudGltZW91dCgxMDAwMCk7XG4gICAgc3Bhd25Qb3VjaGRiU2VydmVyKFxuICAgICAgICB7XG4gICAgICAgICAgICBwb3J0OiA4NzQxLFxuICAgICAgICAgICAgYmFja2VuZDogZmFsc2UsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBhZG1pbnM6IHsgXCJhZG1pbnVzZXJcIjogXCJhZG1pbnBhc3NcIiB9LFxuICAgICAgICAgICAgICAgIGZpbGU6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiB7XG4gICAgICAgICAgICAgICAgZmlsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbGV2ZWw6ICdpbmZvJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IsIHNlcnZlcikge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgU2VydmVyID0gc2VydmVyXG4gICAgICAgICAgICAgICAgQ291Y2hBdXRoID0gbmV3IGNvdWNoYXV0aCh7XG4gICAgICAgICAgICAgICAgICAgIGhvc3RuYW1lOiAnbG9jYWxob3N0JyxcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICdodHRwJyxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogODc0MSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcjogJ2FkbWludXNlcicsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAnYWRtaW5wYXNzJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgICAgICB9LCA1MDAwKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG59KTtcblxuLy8gd3JpdGUgdGVzdHMgYWJvdXQgbXVsdGlwbGUgdmFsdWVzICgyIGlwIG9yIDIgZ2F0ZXdheSBmb3IgdGhlIHNhbWUgaW50ZXJmYWNlKVxuZGVzY3JpYmUoXCJ0ZXN0IGFwcF9tYWluXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnRpbWVvdXQoMjAwMDApO1xuXG4gICAgaXQoXCJ2ZXJpZmljYXRlIHByZXNlbmNlIG9mIGFwcF9tYWluIGRiXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKENvdWNoQXV0aC5teSgnYXBwX21haW4nKSlcblxuICAgICAgICBycGouZ2V0KENvdWNoQXV0aC5teSgnYXBwX21haW4nKSkudGhlbihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgZXhwZWN0KGQuZGJfbmFtZSkudG8uYmUuZXEoJ2FwcF9tYWluJyk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSk7XG4gICAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBpdChcInZlcmlmaWNhdGUgdGhhdCBhcHBfbWFpbiBkYiBpcyBwcml2YXRlXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKENvdWNoQXV0aC5teSgnYXBwX21haW4nKSlcbiAgICAgICAgcnBqLmdldChDb3VjaEF1dGgucHVibGluayArICcvYXBwX21haW4nKS50aGVuKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGQpKTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgZXhwZWN0KGVycikudG8uYmUub2s7XG4gICAgICAgICAgICBkb25lKClcbiAgICAgICAgfSlcbiAgICB9KTtcblxuXG59KTtcbmRlc2NyaWJlKFwibWFpbiBhZG1pbnNcIiwgZnVuY3Rpb24gKCkge1xuICAgIGl0KFwiY3JlYXRlIGEgbWFpbiBhZG1pbiAoZm9yIHRlc3Qgb25seSlcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB9KVxuICAgIGl0KFwiY3JlYXRlIGFuIGFwcFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG59KVxuXG5kZXNjcmliZShcInVzZXJzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpdChcInVzZXIgcmVnaXN0cmF0aW9uXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgfSlcbiAgICBpdChcInVzZXIgc3Vic2NyaWJlIGFuIGFwcFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG4gICAgaXQoXCJ1c2VyIGxvZ2luXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgfSlcbiAgICBpdChcImNyZWF0ZSBhIG1hY2hpbmUgZm9yIGFuIGFwcCBzdWJzY3JpYmVkXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgfSlcbiAgICBpdChcImNhbid0IGNyZWF0ZSBhIG1hY2hpbmUgZm9yIGFuIGFwcCB0aGF0IG5vdCBzdWJzY3JpYmVkIHlldFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG4gICAgaXQoXCJzaGFyZSBhIG1hY2hpbmUgdGhhdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB9KVxuICAgIGl0KFwiY2FuJ3Qgc2hhcmUgYSBtYWNoaW5lIHRoYXQgbm90IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG4gICAgaXQoXCJjaGFuZ2UgYSB1c2VyIHJvbGUgZm9yIGEgbWFjaGluZSB0aGF0IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG4gICAgaXQoXCJjYW4ndCBjaGFuZ2UgIGEgdXNlciByb2xlIGZvciBhIG1hY2hpbmUgdGhhdCBub3Qgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgfSlcbiAgICBpdChcImRlbGV0ZSBhIG1hY2hpbmUgdGhhdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB9KVxuICAgIGl0KFwiY2FuJ3QgZGVsZXRlIGEgbWFjaGluZSB0aGF0IG5vdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB9KVxuICAgIGl0KFwiZ2FyYW50IGEgcHJpdmlsZWdlXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgfSlcbiAgICBpdChcInJldm9rZSBhIHByaXZpbGVnZVwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgIH0pXG59KTtcblxuYWZ0ZXIoZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBTZXJ2ZXIuc3RvcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvbmUoKVxuICAgIH0pXG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
