"use strict";
var chai = require("chai");
var index_1 = require("../index");
var rpj = require('request-promise-json');
var spawnPouchdbServer = require('spawn-pouchdb-server');
var testport = 8742;
var user0 = {
    user: 'testuser0',
    password: 'testpassw0',
    email: 'testuser0@test.tst'
};
var user1 = {
    user: 'testuser1',
    password: 'testpassw1',
    email: 'testuser1@test.tst'
};
var expect = chai.expect;
var Server;
var CouchAuth;
before(function (done) {
    this.timeout(20000);
    spawnPouchdbServer({
        port: testport,
        backend: false,
        config: {
            admins: { "adminuser": "adminpass" },
            file: false
        },
        log: {
            file: false,
            level: 'info'
        }
    }, function (error, server) {
        if (error) {
            throw error;
        }
        else {
            Server = server;
            CouchAuth = new index_1.default({
                hostname: 'localhost',
                protocol: 'http',
                port: testport,
                user: 'adminuser',
                password: 'adminpass'
            });
            setTimeout(function () {
                done();
            }, 1000);
        }
    });
});
describe("test app_main", function () {
    this.timeout(20000);
    it("verificate presence of app_main db", function (done) {
        rpj.get(CouchAuth.my('app_main')).then(function (d) {
            rpj.put(CouchAuth.my('app_main') + '/testdoctobepresent0', { _id: 'testdoctobepresent0', ee: true }).then(function (d) {
                expect(d).to.be.ok;
                expect(d).to.be.an('object');
                done();
            }).catch(function (err) {
                console.log(err);
                done(Error(err));
            });
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("verificate that app_main db is private", function (done) {
        rpj.put(CouchAuth.publink + '/app_main/testdocnotbepresent0', { _id: 'testdocnotbepresent0', ee: true }).then(function (d) {
            done(Error(d));
        }).catch(function (err) {
            expect(err).to.be.ok;
            done();
        });
    });
    it("verificate admin user", function (done) {
        rpj.get(CouchAuth.my('_users/org.couchdb.user:' + 'adminuser')).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.have.property('name').that.eq('adminuser');
            expect(d).to.have.property('email');
            expect(d).to.have.property('roles').that.is.an('array');
            expect(d).to.have.property('db').that.is.an('array');
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
});
describe("create a new app", function () {
    it("main admin add first app", function (done) {
        CouchAuth.createapp('testapp').then(function (d) {
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
});
describe("users", function () {
    describe("registration", function () {
        var slave;
        it("create an user", function (done) {
            CouchAuth.register({ username: user0.user, password: user0.password, email: user0.email, app_id: 'testapp' }).then(function () {
                rpj.get(CouchAuth.my('_users/org.couchdb.user:' + user0.user)).then(function (d) {
                    expect(d).to.be.ok;
                    expect(d).to.have.property('name').that.eq(user0.user);
                    expect(d).to.have.property('email').that.eq(user0.email);
                    expect(d).to.have.property('roles').that.is.an('array');
                    expect(d.roles[0]).to.be.eq('user');
                    expect(d).to.have.property('type').that.eq('user');
                    expect(d).to.have.property('db').that.is.an('array');
                    expect(d.db[0]).to.have.property('app_id').that.is.a('string').that.eq('testapp');
                    expect(d.db[0]).to.have.property('dbname').that.is.a('string');
                    expect(d.db[0]).to.have.property('dbtype').that.is.a('string').that.eq('mine');
                    expect(d.db[0]).to.have.property('roles').that.is.an('array');
                    expect(d.db[0].roles[0]).to.be.eq('owner');
                    expect(d.db[0]).to.have.property('slave').that.is.an('object');
                    expect(d.db[0].slave).to.have.property('username').that.is.a('string');
                    expect(d.db[0].slave).to.have.property('password').that.is.a('string');
                    slave = d.db[0].slave;
                    done();
                }).catch(function (err) {
                    done(Error(err));
                });
            }).catch(function (err) {
                done(Error(err));
            });
        });
        it("check slave", function (done) {
            rpj.get(CouchAuth.my('_users/org.couchdb.user:' + slave.username)).then(function (d) {
                expect(d).to.be.ok;
                expect(d).to.have.property('name').that.eq(slave.username);
                expect(d).to.have.property('roles').that.is.an('array');
                expect(d.roles[0]).to.be.eq('slave');
                expect(d).to.have.property('app').that.is.an('object');
                expect(d.app).to.have.property('db').that.is.a('string');
                expect(d.app).to.have.property('user').that.is.a('string');
                expect(d).to.have.property('dbtype').that.is.a('string').that.eq('userslave');
                expect(d).to.have.property('type').that.is.a('string').that.eq('user');
                done();
            }).catch(function (err) {
                done(Error(err));
            });
        });
        it("can login", function (done) {
            CouchAuth.login({ username: user0.user, password: user0.password, app_id: 'testapp' }).then(function () {
                done();
            }).catch(function (err) {
                done(Error(err));
            });
        });
    });
    describe("machine", function () {
        it("create a machine for an app subscribed", function (done) {
            done();
        });
        it("can't create a machine for an app that not subscribed yet", function (done) {
            done();
        });
        it("share a machine that own", function (done) {
            done();
        });
        it("can't share a machine that not own", function (done) {
            done();
        });
        it("change a user role for a machine that own", function (done) {
            done();
        });
        it("can't change  a user role for a machine that not own", function (done) {
            done();
        });
        it("delete a machine that own", function (done) {
            done();
        });
        it("can't delete a machine that not own", function (done) {
            done();
        });
    });
});
after(function (done) {
    Server.stop(function () {
        done();
    });
});

//# sourceMappingURL=data:application/json;base64,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LElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBRW5ELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFFckQsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUNsRixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMvRCxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBRS9FLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzlELE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUUzQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMvRCxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDdkUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBRXZFLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztvQkFDdEIsSUFBSSxFQUFFLENBQUM7Z0JBSVgsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsR0FBRztvQkFDVCxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsR0FBRztnQkFDVCxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDckIsQ0FBQyxDQUFDLENBQUE7UUFJTixDQUFDLENBQUMsQ0FBQTtRQUVGLEVBQUUsQ0FBQyxhQUFhLEVBQUUsVUFBVSxJQUFJO1lBRTVCLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQywwQkFBMEIsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDO2dCQUV0RSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7Z0JBRW5CLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFFM0QsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN4RCxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUdyQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3ZELE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3pELE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBRTNELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUU5RSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFFdkUsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO2dCQUNULElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQTtRQUlOLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLFdBQVcsRUFBRSxVQUFVLElBQUk7WUFHMUIsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFFeEYsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO2dCQUNULElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQTtRQUlOLENBQUMsQ0FBQyxDQUFBO0lBRU4sQ0FBQyxDQUFDLENBQUE7SUFHRixRQUFRLENBQUMsU0FBUyxFQUFFO1FBR2hCLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxVQUFVLElBQUk7WUFDdkQsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQywyREFBMkQsRUFBRSxVQUFVLElBQUk7WUFDMUUsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxVQUFVLElBQUk7WUFDekMsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxVQUFVLElBQUk7WUFDbkQsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxVQUFVLElBQUk7WUFDMUQsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxVQUFVLElBQUk7WUFDckUsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxVQUFVLElBQUk7WUFDMUMsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtRQUNGLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxVQUFVLElBQUk7WUFDcEQsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQTtJQUVOLENBQUMsQ0FBQyxDQUFBO0FBR04sQ0FBQyxDQUFDLENBQUE7QUFJRixLQUFLLENBQUMsVUFBVSxJQUFJO0lBQ2hCLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDUixJQUFJLEVBQUUsQ0FBQTtJQUNWLENBQUMsQ0FBQyxDQUFBO0FBRU4sQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbW9jaGEgZnJvbSBcIm1vY2hhXCI7XG5pbXBvcnQgKiBhcyBjaGFpIGZyb20gXCJjaGFpXCI7XG5cbmltcG9ydCBjb3VjaGF1dGggZnJvbSBcIi4uL2luZGV4XCI7XG5cbmNvbnN0IHJwaiA9IHJlcXVpcmUoJ3JlcXVlc3QtcHJvbWlzZS1qc29uJyk7XG5jb25zdCBzcGF3blBvdWNoZGJTZXJ2ZXIgPSByZXF1aXJlKCdzcGF3bi1wb3VjaGRiLXNlcnZlcicpO1xuXG5jb25zdCB0ZXN0cG9ydCA9IDg3NDI7XG5cbmNvbnN0IHVzZXIwID0ge1xuICAgIHVzZXI6ICd0ZXN0dXNlcjAnLFxuICAgIHBhc3N3b3JkOiAndGVzdHBhc3N3MCcsXG4gICAgZW1haWw6ICd0ZXN0dXNlcjBAdGVzdC50c3QnXG59XG5cbmNvbnN0IHVzZXIxID0ge1xuICAgIHVzZXI6ICd0ZXN0dXNlcjEnLFxuICAgIHBhc3N3b3JkOiAndGVzdHBhc3N3MScsXG4gICAgZW1haWw6ICd0ZXN0dXNlcjFAdGVzdC50c3QnXG59XG5cbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxuXG5sZXQgU2VydmVyO1xuXG5cblxubGV0IENvdWNoQXV0aDogY291Y2hhdXRoO1xuXG5cblxuYmVmb3JlKGZ1bmN0aW9uIChkb25lKSB7XG4gICAgdGhpcy50aW1lb3V0KDIwMDAwKTtcbiAgICBzcGF3blBvdWNoZGJTZXJ2ZXIoXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBvcnQ6IHRlc3Rwb3J0LFxuICAgICAgICAgICAgYmFja2VuZDogZmFsc2UsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBhZG1pbnM6IHsgXCJhZG1pbnVzZXJcIjogXCJhZG1pbnBhc3NcIiB9LFxuICAgICAgICAgICAgICAgIGZpbGU6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9nOiB7XG4gICAgICAgICAgICAgICAgZmlsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbGV2ZWw6ICdpbmZvJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IsIHNlcnZlcikge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgU2VydmVyID0gc2VydmVyXG5cblxuICAgICAgICAgICAgICAgIENvdWNoQXV0aCA9IG5ldyBjb3VjaGF1dGgoe1xuICAgICAgICAgICAgICAgICAgICBob3N0bmFtZTogJ2xvY2FsaG9zdCcsXG4gICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAnaHR0cCcsXG4gICAgICAgICAgICAgICAgICAgIHBvcnQ6IHRlc3Rwb3J0LFxuICAgICAgICAgICAgICAgICAgICB1c2VyOiAnYWRtaW51c2VyJyxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdhZG1pbnBhc3MnXG4gICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG5cblxuXG5cblxuXG59KTtcblxuXG5kZXNjcmliZShcInRlc3QgYXBwX21haW5cIiwgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGltZW91dCgyMDAwMCk7XG5cbiAgICBpdChcInZlcmlmaWNhdGUgcHJlc2VuY2Ugb2YgYXBwX21haW4gZGJcIiwgZnVuY3Rpb24gKGRvbmUpIHtcblxuXG4gICAgICAgIHJwai5nZXQoQ291Y2hBdXRoLm15KCdhcHBfbWFpbicpKS50aGVuKGZ1bmN0aW9uIChkKSB7XG5cbiAgICAgICAgICAgIHJwai5wdXQoQ291Y2hBdXRoLm15KCdhcHBfbWFpbicpICsgJy90ZXN0ZG9jdG9iZXByZXNlbnQwJywgeyBfaWQ6ICd0ZXN0ZG9jdG9iZXByZXNlbnQwJywgZWU6IHRydWUgfSkudGhlbihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uYmUuYW4oJ29iamVjdCcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgICAgIH0pXG5cblxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICB9KVxuICAgIH0pO1xuXG4gICAgaXQoXCJ2ZXJpZmljYXRlIHRoYXQgYXBwX21haW4gZGIgaXMgcHJpdmF0ZVwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhDb3VjaEF1dGgubXkoJ2FwcF9tYWluJykpXG4gICAgICAgIHJwai5wdXQoQ291Y2hBdXRoLnB1YmxpbmsgKyAnL2FwcF9tYWluL3Rlc3Rkb2Nub3RiZXByZXNlbnQwJywgeyBfaWQ6ICd0ZXN0ZG9jbm90YmVwcmVzZW50MCcsIGVlOiB0cnVlIH0pLnRoZW4oZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGRvbmUoRXJyb3IoZCkpO1xuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoZXJyKS50by5iZS5vaztcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcblxuICAgIH0pO1xuXG5cbiAgICBpdChcInZlcmlmaWNhdGUgYWRtaW4gdXNlclwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhDb3VjaEF1dGgubXkoJ2FwcF9tYWluJykpXG4gICAgICAgIHJwai5nZXQoQ291Y2hBdXRoLm15KCdfdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgJ2FkbWludXNlcicpKS50aGVuKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uYmUub2s7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnbmFtZScpLnRoYXQuZXEoJ2FkbWludXNlcicpO1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ2VtYWlsJyk7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgncm9sZXMnKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ2RiJykudGhhdC5pcy5hbignYXJyYXknKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgfSlcblxuICAgIH0pO1xuXG5cbn0pO1xuZGVzY3JpYmUoXCJjcmVhdGUgYSBuZXcgYXBwXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpdChcIm1haW4gYWRtaW4gYWRkIGZpcnN0IGFwcFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBDb3VjaEF1dGguY3JlYXRlYXBwKCd0ZXN0YXBwJykudGhlbihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuXG4gICAgICAgICAgICBkb25lKClcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgfSlcbiAgICB9KVxufSlcbmRlc2NyaWJlKFwidXNlcnNcIiwgZnVuY3Rpb24gKCkge1xuICAgIGRlc2NyaWJlKFwicmVnaXN0cmF0aW9uXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHNsYXZlO1xuXG4gICAgICAgIGl0KFwiY3JlYXRlIGFuIHVzZXJcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIENvdWNoQXV0aC5yZWdpc3Rlcih7IHVzZXJuYW1lOiB1c2VyMC51c2VyLCBwYXNzd29yZDogdXNlcjAucGFzc3dvcmQsIGVtYWlsOiB1c2VyMC5lbWFpbCwgYXBwX2lkOiAndGVzdGFwcCcgfSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblxuICAgICAgICAgICAgICAgIHJwai5nZXQoQ291Y2hBdXRoLm15KCdfdXNlcnMvb3JnLmNvdWNoZGIudXNlcjonICsgdXNlcjAudXNlcikpLnRoZW4oZnVuY3Rpb24gKGQpIHtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uYmUub2s7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCduYW1lJykudGhhdC5lcSh1c2VyMC51c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ2VtYWlsJykudGhhdC5lcSh1c2VyMC5lbWFpbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ3JvbGVzJykudGhhdC5pcy5hbignYXJyYXknKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQucm9sZXNbMF0pLnRvLmJlLmVxKCd1c2VyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnKS50aGF0LmVxKCd1c2VyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ2RiJykudGhhdC5pcy5hbignYXJyYXknKTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXSkudG8uaGF2ZS5wcm9wZXJ0eSgnYXBwX2lkJykudGhhdC5pcy5hKCdzdHJpbmcnKS50aGF0LmVxKCd0ZXN0YXBwJyk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdKS50by5oYXZlLnByb3BlcnR5KCdkYm5hbWUnKS50aGF0LmlzLmEoJ3N0cmluZycpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXSkudG8uaGF2ZS5wcm9wZXJ0eSgnZGJ0eXBlJykudGhhdC5pcy5hKCdzdHJpbmcnKS50aGF0LmVxKCdtaW5lJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQuZGJbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3JvbGVzJykudGhhdC5pcy5hbignYXJyYXknKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQuZGJbMF0ucm9sZXNbMF0pLnRvLmJlLmVxKCdvd25lcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdKS50by5oYXZlLnByb3BlcnR5KCdzbGF2ZScpLnRoYXQuaXMuYW4oJ29iamVjdCcpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXS5zbGF2ZSkudG8uaGF2ZS5wcm9wZXJ0eSgndXNlcm5hbWUnKS50aGF0LmlzLmEoJ3N0cmluZycpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXS5zbGF2ZSkudG8uaGF2ZS5wcm9wZXJ0eSgncGFzc3dvcmQnKS50aGF0LmlzLmEoJ3N0cmluZycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNsYXZlID0gZC5kYlswXS5zbGF2ZTtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuXG5cblxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSk7XG4gICAgICAgICAgICB9KVxuXG5cblxuICAgICAgICB9KVxuXG4gICAgICAgIGl0KFwiY2hlY2sgc2xhdmVcIiwgZnVuY3Rpb24gKGRvbmUpIHtcblxuICAgICAgICAgICAgcnBqLmdldChDb3VjaEF1dGgubXkoJ191c2Vycy9vcmcuY291Y2hkYi51c2VyOicgKyBzbGF2ZS51c2VybmFtZSkpLnRoZW4oKGQpID0+IHtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcblxuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCduYW1lJykudGhhdC5lcShzbGF2ZS51c2VybmFtZSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgncm9sZXMnKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkLnJvbGVzWzBdKS50by5iZS5lcSgnc2xhdmUnKTtcblxuXG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ2FwcCcpLnRoYXQuaXMuYW4oJ29iamVjdCcpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkLmFwcCkudG8uaGF2ZS5wcm9wZXJ0eSgnZGInKS50aGF0LmlzLmEoJ3N0cmluZycpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkLmFwcCkudG8uaGF2ZS5wcm9wZXJ0eSgndXNlcicpLnRoYXQuaXMuYSgnc3RyaW5nJyk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnZGJ0eXBlJykudGhhdC5pcy5hKCdzdHJpbmcnKS50aGF0LmVxKCd1c2Vyc2xhdmUnKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCd0eXBlJykudGhhdC5pcy5hKCdzdHJpbmcnKS50aGF0LmVxKCd1c2VyJyk7XG5cbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgICAgIH0pXG5cblxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgaXQoXCJjYW4gbG9naW5cIiwgZnVuY3Rpb24gKGRvbmUpIHtcblxuXG4gICAgICAgICAgICBDb3VjaEF1dGgubG9naW4oeyB1c2VybmFtZTogdXNlcjAudXNlciwgcGFzc3dvcmQ6IHVzZXIwLnBhc3N3b3JkLCBhcHBfaWQ6ICd0ZXN0YXBwJyB9KS50aGVuKCgpID0+IHtcblxuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICAgICAgfSlcblxuXG5cbiAgICAgICAgfSlcblxuICAgIH0pXG5cblxuICAgIGRlc2NyaWJlKFwibWFjaGluZVwiLCBmdW5jdGlvbiAoKSB7XG5cblxuICAgICAgICBpdChcImNyZWF0ZSBhIG1hY2hpbmUgZm9yIGFuIGFwcCBzdWJzY3JpYmVkXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwiY2FuJ3QgY3JlYXRlIGEgbWFjaGluZSBmb3IgYW4gYXBwIHRoYXQgbm90IHN1YnNjcmliZWQgeWV0XCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwic2hhcmUgYSBtYWNoaW5lIHRoYXQgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwiY2FuJ3Qgc2hhcmUgYSBtYWNoaW5lIHRoYXQgbm90IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KVxuICAgICAgICBpdChcImNoYW5nZSBhIHVzZXIgcm9sZSBmb3IgYSBtYWNoaW5lIHRoYXQgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwiY2FuJ3QgY2hhbmdlICBhIHVzZXIgcm9sZSBmb3IgYSBtYWNoaW5lIHRoYXQgbm90IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KVxuICAgICAgICBpdChcImRlbGV0ZSBhIG1hY2hpbmUgdGhhdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaXQoXCJjYW4ndCBkZWxldGUgYSBtYWNoaW5lIHRoYXQgbm90IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KVxuXG4gICAgfSlcblxuXG59KVxuXG5cblxuYWZ0ZXIoZnVuY3Rpb24gKGRvbmUpIHtcbiAgICBTZXJ2ZXIuc3RvcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvbmUoKVxuICAgIH0pXG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
